<html lang="en">
<head>
    <script src="knockout-3.5.0.js" type="text/javascript"></script>
	<style>
			table, th, td {
			  border: 1px solid black;
			}
		</style>
</head>
<body>
    <main>
        <div class="container">    
            <hr>
                <div style="width:40%;float:left">
                    <h2>Available Person List</h2>
                        <div>
                            <table id="available-table" style="width:100%">
                                <thead>
                                    <tr>
                                        <th><strong>First Name</strong></th>
                                        <th><strong>Last Name</strong></th>
                                        <th><strong>Age</strong></th>
                                        <th><strong>Action</strong></th>
                                    </tr>
                                </thead>
                                <tbody data-bind="foreach: userCondition">
                                    <tr data-bind="click: $parent.selectUser">
                                        <td data-bind="text: firstName"></td>
                                        <td data-bind="text: lastName"></td>
                                        <td data-bind="text: age"></td>
                                        <th><button data-bind="click: $parent.removeUser">Remove</button>
                                        </th>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="4" align="center">
                                            <i>Sum Ages:</i> <strong data-bind="text: sumAgeAvailableList"></strong>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
							<div>
								<h3>Person Info</h3>
								<b>- First name: </b> <input type="text" style="margin-bottom:30px"
									data-bind="value: fName(), valueUpdate: 'afterkeydown'">
									<span data-bind='visible: fName().hasError, text: fName().validationMessage'></span>
								<br>
								<b>- Last name: </b> <input type="text" style="margin-bottom:30px"
									data-bind="value: lName(), valueUpdate: 'afterkeydown'">
									<span data-bind='visible: lName().hasError, text: lName().validationMessage'></span>
								<br>
								<b>- Age: </b>
								<input type="text" data-bind="value: iAge(), valueUpdate: 'afterkeydown'"
									style="margin-bottom:30px">
									<span data-bind='visible: iAge().hasError, text: iAge().validationMessage'></span>
								<br />
							</div>
							<div>
								<h3>Intro</h3>                  
								<!-- <div style="margin-top:8%">
									<i data-bind="text: fullName"></i> <strong><i data-bind="text: teenOrRetire"></i></strong>
									<br>
								</div> -->
							</div>
                        </div>
					</div>
					<div style="width:40%;float: left;margin-left:100px">
						<h2>Remove Person List</h2>
							<table id="remove-table" style="width:100%;float: right">
								<thead>
									<tr>
										<td><strong>First Name</strong></td>
										<td><strong>Last Name</strong></td>
										<td><strong>Age</strong></td>
										<td><strong>Action</strong></td>
									</tr>
								</thead>
								<tbody data-bind="foreach: removeUserList">
									<tr data-bind="click: $parent.select">
										<td data-bind="text: firstName"></td>
										<td data-bind="text: lastName"></td>
										<td data-bind="text: age"></td>
										<td><button data-bind="click: $parent.undoUser">Undo</button>
										</td>
									</tr>
								</tbody>
								<tfoot>
									<tr>
										<td colspan="4" align="center">
											<i>Sum Ages:</i> <strong data-bind="text: sumAgeRemoveList"></strong>
										</td>
									</tr>
								</tfoot>
							</table>
					</div>			
            </div>
        <script>
            ko.extenders.logChange = function(target, option) {
                target.hasError = ko.observable();
                target.validationMessage = ko.observable();
                
                function validate(newValue){
                    if(option == 'first name'){
                        if(newValue.charAt(0) == 'M'){
                            if(newValue.length < 5 || newValue.length > 10){
                                target.hasError(true);
                                target.validationMessage("Length is 5 - 10 char!");
                            }
                        }else{
                            target.hasError(true);
                            target.validationMessage("This field start with 'M'");
                        }
                    }
                    
                    if(option == 'last name'){
                        if(newValue.length < 5 || newValue.length > 10){
                            target.hasError(true);
                            target.validationMessage("Length is 5 - 10 char!");
                        }else{
                            target.hasError(false);
                            target.validationMessage("");
                        }
                    }
                    
                    if(option == 'age'){
                        if(parseInt(newValue) == 0 || parseInt(newValue) > 99){
                            target.hasError(true);
                            target.validationMessage("this field is between 1 -99");
                        }else{
                            target.hasError(false);
                            target.validationMessage("");
                        }
                    }
                }
                validate(target());
                target.subscribe(validate);
                return target;
            }
            //Fake constructor
            function createUser(firstName,lastName,age){
                this.firstName = ko.observable(firstName);
                this.lastName = ko.observable(lastName);
                this.age = ko.observable(age);
            }
            //Get Data
            var filterArray = function (){
                var self = this;
                this.sourceArray = [
                    { firstName: 'Emilia', lastName: 'Mcintyre' },
                    { firstName: 'Shiya', lastName: 'Babb' },
                    { firstName: 'Marcial', lastName: 'Bise' },
                    { firstName: 'Kalista', lastName: 'Morrow' },
                    { firstName: 'Martina', lastName: 'Schindler' },
                    { firstName: 'Jacayla', lastName: 'Parsons' },
                    { firstName: 'Kimorah', lastName: 'Dodge' },
                    { firstName: 'Areli', lastName: 'Kaplan' },
                    { firstName: 'Vayda', lastName: 'Shunk' },
                    { firstName: 'Ivania', lastName: 'Youngman' },
                    { firstName: 'Neyla', lastName: 'Woodley' },
                    { firstName: 'Neftali', lastName: 'Abell' },
                    { firstName: 'Lacey', lastName: 'Erdman' },
                    { firstName: 'Colleen', lastName: 'Johnston' },
                    { firstName: 'London', lastName: 'Springer' },
                    { firstName: 'Maddoxx', lastName: 'Hartig' },
                    { firstName: 'Jadyne', lastName: 'Hebert' },
                    { firstName: 'Madalynn', lastName: 'Crow' },
                    { firstName: 'Monzerrat', lastName: 'Wallace' },
                    { firstName: 'Malasia', lastName: 'Bradshaw' },
                    { firstName: 'Mia', lastName: 'Phillips' },
                    { firstName: 'Miraya', lastName: 'Kaye' },
                    { firstName: 'Anaya', lastName: 'Navarrete' },
                    { firstName: 'Callie', lastName: 'Robertson' },
                    { firstName: 'Mariah', lastName: 'Obrien' },
                    { firstName: 'Marlen', lastName: 'Justice' },
                    { firstName: 'Isys', lastName: 'Babineaux' },
                    { firstName: 'Perri', lastName: 'Wynn' },
                    { firstName: 'Beckem', lastName: 'Currie' },
                    { firstName: 'Madison', lastName: 'Flynn' },
                    { firstName: 'Ariana', lastName: 'Herbert' },
                    { firstName: 'Isela', lastName: 'Vinci' },
                    { firstName: 'Keturah', lastName: 'Buford' },
                    { firstName: 'Alayah', lastName: 'Cuadrado' },
                    { firstName: 'Nikkita', lastName: 'Mcfarland' },
                    { firstName: 'Mckayla', lastName: 'Benavidez' },
                ];
                this.filterArray = [];
                this.sourceArray.forEach(item => {
                    let randomAge = Math.floor(Math.random() * 99) + 1;
                    // Filter user with fullname length bigger than 12 and firstName begin with 'M' ↓↓↓
                    if (item.firstName.length + item.lastName.length > 12 && item.firstName.charAt(0) == "M") {
                        self.filterArray.push(new createUser(item.firstName,item.lastName,randomAge));
                    }
                });
                return this.filterArray;
            }
            //Sum Age Available
            var totalAge= function (array){
                var sumValue = 0;
                array.forEach(item => {
                    sumValue += parseInt(array.age());
                });
                return sumValue;
            }
            //Check position
            var position = function (removeList,object){
                let position = removeList.findIndex(function(item){
                    if(item.firstName==object.firstName&&item.lastName==object.lastName&&item.age==object.age){
                        return true;
                    }
                });
                return position;
            }
            //Push or Remove observableArray
            function exChange(removeList,pushList,object){
                removeList.remove(object);
                pushList.push(object);
            }
            //push selectedItem
            function pushSelectedItem(object){
                ViewModel.fName(object.firstName());
                ViewModel.lName(object.lastName());
                ViewModel.iAge(object.age());
            }
            //Model
            var ViewModel = {
                userCondition: ko.observableArray(filterArray()),
                removeUserList: ko.observableArray([]),
                selectedItem: ko.observableArray(),
                fName: ko.observable("").extend({logChange: "first name"}),
                lName: ko.observable("").extend({logChange: "last name"}),
                iAge: ko.observable("").extend({logChange: "age"}),
                sumAgeAvailableList: ko.computed(function(){
                    // return totalAge(ViewModel.userCondition);
                }),
                sumAgeRemoveList: ko.observable(),
                removeUser: function(item){ 
                    exChange(ViewModel.userCondition,ViewModel.removeUserList,item);
                },
                undoUser: function(item){ 
                    exChange(ViewModel.removeUserList,ViewModel.userCondition,item);
                },
                selectUser: function(item){ 
                    pushSelectedItem(item);
                }        
            }
            // console.log(ViewModel.selectedItem());
            ko.applyBindings(ViewModel);
        </script>
    </body>
</html>