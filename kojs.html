<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="library/knockout-3.5.0.js" type="text/javascript"></script>
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/style.css">
	<script src="css/jquery-3.3.1.min.js" type="text/javascript"></script>
</head>

<body>
	<div class="container">
		<div class="page-header">
			<h1><strong style="color:rgb(20, 153, 214)">SCC Internship</strong><small><i> We make IT work</i></small>
			</h1>
		</div>
		<div class="panel panel-info" style="float: left; margin-top: 2%; width:48%">
			<div class="panel-heading">
				<h3>Available Person List</h3>
			</div>
			<table class="table table-striped table-hover">
				<thead>
					<tr align="center" style="font-size: 18px">
						<td scope="col"><strong>First Name</strong></td>
						<td scope="col"><strong>Last Name</strong></td>
						<td scope="col"><strong>Age</strong></td>
						<td scope="col"><strong>Action</strong></td>
					</tr>
				</thead>
				<tbody data-bind="foreach: userCondition">
					<tr data-bind="click: $parent.selectUser" align="center">
						<td data-bind="text: firstName"></td>
						<td data-bind="text: lastName"></td>
						<td data-bind="text: age"></td>
						<td><button class="btn btn-danger" data-bind="click: $parent.removeUser">Remove</button></td>
					</tr>
				</tbody>
				<tfoot style="background-color:#d9edf7">
					<tr>
						<td colspan="4" align="center">
							<i>Total Ages: </i><strong data-bind="text: sumAgeAvailableList"></strong>
						</td>
					</tr>
				</tfoot>
			</table>

		</div>

		<div class="panel panel-danger" style="float: right; margin-top: 2%; width:48%">
			<div class="panel-heading">
				<h3>Removed Person List</h3>
			</div>
			<table class="table table-striped table-hover">
				<thead>
					<tr align="center" style="font-size: 18px">
						<td scope="col"><strong>First Name</strong></td>
						<td scope="col"><strong>Last Name</strong></td>
						<td scope="col"><strong>Age</strong></td>
						<td scope="col"><strong>Action</strong></td>
					</tr>
				</thead>
				<tbody data-bind="foreach: removeUserList">
					<tr align="center">
						<td data-bind="text: firstName"></td>
						<td data-bind="text: lastName"></td>
						<td data-bind="text: age"></td>
						<td><button class="btn btn-danger" data-bind="click: $parent.undoUser">Undo</button></td>
					</tr>
				</tbody>
				<tfoot style="background-color:#f2dede">
					<tr>
						<td colspan="4" align="center">
							<i>Total Ages: </i><strong data-bind="text: sumAgeRemoveList"></strong>
						</td>
					</tr>
				</tfoot>
			</table>
		</div>
		<div style="width:48%">
			<label for="basic-url" style="font-size: 20px; color: blue">Person Info</label>
			<div class="input-group">
				<span class="input-group-addon" id="basic-addon1">First Name</span>
				<input type="text" class="form-control" placeholder="Choose user" aria-describedby="basic-addon2"
					data-bind="value: selectedItem().firstName, valueUpdate: 'afterkeydown'">
				<span class="input-group-addon" style="color: #fff;	background-color: #d9534f; border-color: #d43f3a"
					data-bind='visible: selectedItem().firstName.hasError, text: selectedItem().firstName.validationMessage'></span>
			</div>
			<br>
			<div class="input-group">
				<span class="input-group-addon" id="basic-addon2">Last Name</span>
				<input type="text" class="form-control" placeholder="Choose user" aria-describedby="basic-addon2"
					data-bind="value: selectedItem().lastName, valueUpdate: 'afterkeydown'">
				<span class="input-group-addon" style="color: #fff;	background-color: #d9534f; border-color: #d43f3a"
					data-bind='visible: selectedItem().lastName.hasError, text: selectedItem().lastName.validationMessage'></span>
			</div>
			<br>
			<div class="input-group">
				<span class="input-group-addon" id="basic-addon3">User's Age</span>
				<input type="text" class="form-control" aria-describedby="basic-addon2" placeholder="Choose user"
					data-bind="value: selectedItem().age, valueUpdate: 'afterkeydown'">
				<span class="input-group-addon" style="color: #fff;	background-color: #d9534f; border-color: #d43f3a"
					data-bind='visible: selectedItem().age.hasError, text: selectedItem().age.validationMessage'></span>
			</div>
			<br>
			<label for="basic-url" style="font-size: 20px; color:blue">Introduce</label>
			<div class="input-group">
				<span class="input-group-addon" id="basic-addon4">Status</span>
				<input type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3" readonly
					data-bind="value: fullName">
			</div>
		</div>
	</div>
</body>
<script>
	ko.extenders.logChange = function (target, option) {
		target.hasError = ko.observable(false);
		target.validationMessage = ko.observable("");
		function validate(newValue) {
			if (option == 'fName') {
				if (newValue.charAt(0) == 'M') {
					if (newValue.length < 5 || newValue.length > 10) {
						target.hasError(true);
						target.validationMessage("Length is 5 - 10 char!");
					}else{
						target.hasError(false);
						target.validationMessage("");
					}
				} else {
					target.hasError(true);
					target.validationMessage("The first name start with 'M'");
				}
			}

			if (option == 'lName') {
				if (newValue.length < 5 || newValue.length > 10) {
					target.hasError(true);
					target.validationMessage("Length is 5 - 10 char!");
				} else {
					target.hasError(false);
					target.validationMessage("");
				}
			}

			if (option == 'age') {
				let number = 0 + newValue;
				if (parseInt(newValue) < 1 || parseInt(newValue) > 99 || number == "0") {
					target.hasError(true);
					target.validationMessage("The age is between 1 - 99");
				} else {
					target.hasError(false);
					target.validationMessage("");
				}
			}
		}


		validate(target());

		target.subscribe(validate);

		return target;
	}
	//Fake constructor
	function createUser(firstName, lastName, age) {
		this.firstName = ko.observable(firstName).extend({ logChange: "fName" });
		this.lastName = ko.observable(lastName).extend({ logChange: "lName" });
		this.age = ko.observable(age).extend({ logChange: "age" });
	}
	//Get Data
	var filterArray = function () {
		var self = this;
		this.sourceArray = [
			{ firstName: 'Emilia', lastName: 'Mcintyre' },
			{ firstName: 'Shiya', lastName: 'Babb' },
			{ firstName: 'Marcial', lastName: 'Bise' },
			{ firstName: 'Kalista', lastName: 'Morrow' },
			{ firstName: 'Martina', lastName: 'Schindler' },
			{ firstName: 'Jacayla', lastName: 'Parsons' },
			{ firstName: 'Kimorah', lastName: 'Dodge' },
			{ firstName: 'Areli', lastName: 'Kaplan' },
			{ firstName: 'Vayda', lastName: 'Shunk' },
			{ firstName: 'Ivania', lastName: 'Youngman' },
			{ firstName: 'Neyla', lastName: 'Woodley' },
			{ firstName: 'Neftali', lastName: 'Abell' },
			{ firstName: 'Lacey', lastName: 'Erdman' },
			{ firstName: 'Colleen', lastName: 'Johnston' },
			{ firstName: 'London', lastName: 'Springer' },
			{ firstName: 'Maddoxx', lastName: 'Hartig' },
			{ firstName: 'Jadyne', lastName: 'Hebert' },
			{ firstName: 'Madalynn', lastName: 'Crow' },
			{ firstName: 'Monzerrat', lastName: 'Wallace' },
			{ firstName: 'Malasia', lastName: 'Bradshaw' },
			{ firstName: 'Mia', lastName: 'Phillips' },
			{ firstName: 'Miraya', lastName: 'Kaye' },
			{ firstName: 'Anaya', lastName: 'Navarrete' },
			{ firstName: 'Callie', lastName: 'Robertson' },
			{ firstName: 'Mariah', lastName: 'Obrien' },
			{ firstName: 'Marlen', lastName: 'Justice' },
			{ firstName: 'Isys', lastName: 'Babineaux' },
			{ firstName: 'Perri', lastName: 'Wynn' },
			{ firstName: 'Beckem', lastName: 'Currie' },
			{ firstName: 'Madison', lastName: 'Flynn' },
			{ firstName: 'Ariana', lastName: 'Herbert' },
			{ firstName: 'Isela', lastName: 'Vinci' },
			{ firstName: 'Keturah', lastName: 'Buford' },
			{ firstName: 'Alayah', lastName: 'Cuadrado' },
			{ firstName: 'Nikkita', lastName: 'Mcfarland' },
			{ firstName: 'Mckayla', lastName: 'Benavidez' },
		];
		this.filterArray = [];
		this.sourceArray.forEach(item => {
			let randomAge = Math.floor(Math.random() * 99) + 1;
			// Filter user with fullname length bigger than 12 and firstName begin with 'M' ↓↓↓
			if (item.firstName.length + item.lastName.length > 12 && item.firstName.charAt(0) == "M") {
				self.filterArray.push(new createUser(item.firstName, item.lastName, randomAge));
			}
		});
		return this.filterArray;
	}
	//Sum Age Available
	var totalAge = function (array) {
		var sumValue = 0;
		array().forEach(item => {
			if (item.age()) {
				sumValue += parseInt(item.age());
			}
		});
		return sumValue;
	}
	//Check position
	var position = function (removeList, object) {
		let position = removeList.findIndex(function (item) {
			if (item.firstName == object.firstName && item.lastName == object.lastName && item.age == object.age) {
				return true;
			}
		});
		return position;
	}
	//Push or Remove observableArray
	function exChange(removeList, pushList, object) {
		removeList.remove(object);
		pushList.push(object);
	}
	//return rank of user
	var rank = function (age) {
		var rankUser = " ";
		if (age > 62) {
			rankUser = "Retired";
		}
		if (age < 15) {
			rankUser = "Teenage";
		}
		if (age >= 15 && age <= 62) {
			rankUser = "Adult";
		}
		return rankUser;
	}

	//View Model
	var ViewModel = {
		//Declare
		userCondition: ko.observableArray(filterArray()),
		removeUserList: ko.observableArray([]),
		selectedItem: ko.observable(new createUser('Choose user!', 'Choose user!', 0)),//.extend({required: true}),

		//sum age of Available User List
		sumAgeAvailableList: ko.pureComputed({
			read: function () {
				return totalAge(ViewModel.userCondition);
			},
			write: function (value) {
				return value;
			},
			owner: this
		}),

		////sum age of Available User List
		sumAgeRemoveList: ko.pureComputed({
			read: function () {
				return totalAge(ViewModel.removeUserList);
			},
			write: function (value) {
				return value;
			},
			owner: this
		}),
		//show full name
		fullName: ko.pureComputed({
			read: function () {
				if (ViewModel.selectedItem().firstName() == 'Choose user!') {
					return "No infomation";
				} else {
					return ViewModel.selectedItem().firstName() + " " + ViewModel.selectedItem().lastName() + " is " + rank(ViewModel.selectedItem().age());
				}
			},
			write: function (value) {
				return value;
			},
			owner: this
		}),
		//feature of list
		removeUser: function (item) {
			exChange(ViewModel.userCondition, ViewModel.removeUserList, item);
		},
		undoUser: function (item) {
			exChange(ViewModel.removeUserList, ViewModel.userCondition, item);
		},
		selectUser: function (item) {
			ViewModel.selectedItem(item);
			ViewModel.fullName(ViewModel.selectedItem().firstName + " " + ViewModel.selectedItem().lastName + " is " + rank(ViewModel.selectedItem().age()));
		}
	}


	ko.applyBindings(ViewModel);
</script>