<html lang="en">
<head>
    <script src="knockout-3.5.0.js" type="text/javascript"></script>
	<style>
			table, th, td {
			  border: 1px solid black;
			}
		</style>
</head>
<body>
    <main>
        <div class="container">    
            <hr>
                <div style="width:40%;float:left">
                    <h2>Available Person List</h2>
                        <div>
                            <table id="available-table" style="width:100%">
                                <thead>
                                    <tr>
                                        <th><strong>First Name</strong></th>
                                        <th><strong>Last Name</strong></th>
                                        <th><strong>Age</strong></th>
                                        <th><strong>Action</strong></th>
                                    </tr>
                                </thead>
                                <tbody data-bind="foreach: userCondition">
                                    <tr data-bind="click: $parent.select">
                                        <td data-bind="text: firstName"></td>
                                        <td data-bind="text: lastName"></td>
                                        <td data-bind="text: age" class="text-danger"></td>
                                        <th><button data-bind="click: $parent.remove">Remove</button>
                                        </th>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="4" align="center">
                                            <i>Sum Ages:</i> <strong data-bind="text: sumAgeAvailableList"></strong>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
							<div>
								<h3>Person Info</h3>
								<b>- First name: </b> <input type="text" style="margin-bottom:30px"
									data-bind="value: selectedUser.fName, valueUpdate: 'afterkeydown'">
									<span data-bind='visible: fName().hasError, text: fName().validationMessage'></span>
								<br>
								<b>- Last name: </b> <input type="text" style="margin-bottom:30px"
									data-bind="value: lName(), valueUpdate: 'afterkeydown'">
									<span data-bind='visible: lName().hasError, text: lName().validationMessage'></span>
								<br>
								<b>- Age: </b>
								<input type="text" data-bind="value: iAge(), valueUpdate: 'afterkeydown'"
									style="margin-bottom:30px">
									<span data-bind='visible: iAge().hasError, text: iAge().validationMessage'></span>
								<br />
							</div>
							<div>
								<h3>Intro</h3>                  
								<div style="margin-top:8%">
									<i data-bind="text: fullName"></i> <strong><i data-bind="text: teenOrRetire"></i></strong>
									<br>
								</div>
							</div>
                        </div>
					</div>
					<div style="width:40%;float: left;margin-left:100px">
						<h2>Remove Person List</h2>
							<table id="remove-table" style="width:100%;float: right">
								<thead>
									<tr>
										<td><strong>First Name</strong></td>
										<td><strong>Last Name</strong></td>
										<td><strong>Age</strong></td>
										<td><strong>Feature</strong></td>
									</tr>
								</thead>
								<tbody data-bind="foreach: removeUserList">
									<tr data-bind="click: $parent.select">
										<td data-bind="text: firstName()"></td>
										<td data-bind="text: lastName()"></td>
										<td data-bind="text: age()"></td>
										<td><button data-bind="click: $parent.undo">Undo</button>
										</td>
									</tr>
								</tbody>
								<tfoot>
									<tr>
										<td colspan="4" align="center">
											<i>Sum Ages:</i> <strong data-bind="text: sumAgeRemoveList"></strong>
										</td>
									</tr>
								</tfoot>
							</table>
					</div>			
			</div>
    <script>
		ko.extenders.logChange = function(target, option) {
			target.hasError = ko.observable();
			target.validationMessage = ko.observable();
			
			function validate(newValue){
				if(option == 'first name'){
					if(newValue.charAt(0) == 'M'){
						if(newValue.length < 5 || newValue.length > 10){
							target.hasError(true);
							target.validationMessage("Length is 5 - 10 char!");
						}
					}else{
						target.hasError(true);
						target.validationMessage("This field start with 'M'");
					}
				}
				
				if(option == 'last name'){
					if(newValue.length < 5 || newValue.length > 10){
						target.hasError(true);
						target.validationMessage("Length is 5 - 10 char!");
					}else{
						target.hasError(false);
						target.validationMessage("");
					}
				}
				
				if(option == 'age'){
					if(parseInt(newValue) == 0 || parseInt(newValue) > 99){
						target.hasError(true);
						target.validationMessage("this field is between 1 -99");
					}else{
						target.hasError(false);
						target.validationMessage("");
					}
				}
			}
			validate(target());
			target.subscribe(validate);
			return target;
		}
		function createUser(firstName, lastName, age) {
			var self = this;
			self.firstName = ko.observable(firstName).extend({logChange: "first name"});
			self.lastName = ko.observable(lastName).extend({logChange: "last name"});
			self.age = ko.observable(age).extend({logChange: "age"});
		}

		function sumAge(array) {
			let sumValue = 0;
			array().forEach(item => {
				sumValue += parseInt(item.age());
			});
			return sumValue;
		}

		function ViewModel() {
			var self=this;
			// Declare observable ↓↓↓
			self.userCondition = ko.observableArray();
			self.removeUserList = ko.observableArray();
			self.saveItem = ko.observableArray();
			
			self.sumAgeAvailableList = ko.pureComputed({
				read: function () {
					return sumAge(self.userCondition);
				},
				write: function (value) {
					return value;
				},
				owner: this
			});
			self.sumAgeRemoveList = ko.pureComputed({
				read: function () {
					return sumAge(self.removeUserList);
				},
				write: function (value) {
					return value;
				},
				owner: this
			});

			self.fName = ko.observable("");
			self.lName  = ko.observable("");
			self.iAge = ko.observable("");
			self.teenOrRetire = ko.observable("");

			self.fullName = ko.pureComputed({
				read: function () {
					if (typeof self.fName() == 'function' && typeof self.lName() == 'function') {
						return self.fName()() + " " + self.lName()() + " is";
					}
				},
				write: function (value) {
					return value;
				},
				owner: this
			});

			// Display data ↓↓↓
			user.forEach(user => {
				let randomAge = Math.floor(Math.random() * 99) + 1;

				// Filter user with fullname length bigger than 12 and firstName begin with 'M' ↓↓↓
				if (user.firstName.length + user.lastName.length > 12 && user.firstName.charAt(0) == "M") {
					self.userCondition.push(new createUser(user.firstName, user.lastName, randomAge));
					self.sumAgeAvailableList(sumAge(self.userCondition));
				}
			});

			// Select ↓↓↓
			self.select = function (user) {
				self.selectedUser(user);
				self.selectedUser().fName();
				<!-- self.fName(user.firstName); -->
				<!-- self.lName(user.lastName); -->
				<!-- self.iAge(user.age); -->
				<!-- self.saveItem(user); -->
				self.fullName(user.firstName + " " + user.lastName);

				if (user.age() >= 62)
					self.teenOrRetire("Retired ");
				else if (user.age() >= 13 && user.age() <= 19)
					self.teenOrRetire("Teenage");
				else if (user.age() < 13)
					self.teenOrRetire("Kid");
				else
					self.teenOrRetire("Adult");
			}

			// Remove ↓↓↓
			self.remove = function (user) {
				self.userCondition.remove(user);
				self.removeUserList.push(user);

				self.sumAgeAvailableList(sumAge(self.userCondition));

				self.sumAgeRemoveList(sumAge(self.removeUserList));

			}

			// Undo ↓↓↓
			self.undo = function (user) {
				self.removeUserList.remove(user);
				self.userCondition.push(user);

				self.sumAgeAvailableList(sumAge(self.userCondition));

				self.sumAgeRemoveList(sumAge(self.removeUserList));

			}
			
		}

		// Data
		var user = [
			{ firstName: 'Emilia', lastName: 'Mcintyre' },
			{ firstName: 'Shiya', lastName: 'Babb' },
			{ firstName: 'Marcial', lastName: 'Bise' },
			{ firstName: 'Kalista', lastName: 'Morrow' },
			{ firstName: 'Martina', lastName: 'Schindler' },
			{ firstName: 'Jacayla', lastName: 'Parsons' },
			{ firstName: 'Kimorah', lastName: 'Dodge' },
			{ firstName: 'Areli', lastName: 'Kaplan' },
			{ firstName: 'Vayda', lastName: 'Shunk' },
			{ firstName: 'Ivania', lastName: 'Youngman' },
			{ firstName: 'Neyla', lastName: 'Woodley' },
			{ firstName: 'Neftali', lastName: 'Abell' },
			{ firstName: 'Lacey', lastName: 'Erdman' },
			{ firstName: 'Colleen', lastName: 'Johnston' },
			{ firstName: 'London', lastName: 'Springer' },
			{ firstName: 'Maddoxx', lastName: 'Hartig' },
			{ firstName: 'Jadyne', lastName: 'Hebert' },
			{ firstName: 'Madalynn', lastName: 'Crow' },
			{ firstName: 'Monzerrat', lastName: 'Wallace' },
			{ firstName: 'Malasia', lastName: 'Bradshaw' },
			{ firstName: 'Mia', lastName: 'Phillips' },
			{ firstName: 'Miraya', lastName: 'Kaye' },
			{ firstName: 'Anaya', lastName: 'Navarrete' },
			{ firstName: 'Callie', lastName: 'Robertson' },
			{ firstName: 'Mariah', lastName: 'Obrien' },
			{ firstName: 'Marlen', lastName: 'Justice' },
			{ firstName: 'Isys', lastName: 'Babineaux' },
			{ firstName: 'Perri', lastName: 'Wynn' },
			{ firstName: 'Beckem', lastName: 'Currie' },
			{ firstName: 'Madison', lastName: 'Flynn' },
			{ firstName: 'Ariana', lastName: 'Herbert' },
			{ firstName: 'Isela', lastName: 'Vinci' },
			{ firstName: 'Keturah', lastName: 'Buford' },
			{ firstName: 'Alayah', lastName: 'Cuadrado' },
			{ firstName: 'Nikkita', lastName: 'Mcfarland' },
			{ firstName: 'Mckayla', lastName: 'Benavidez' },
		];
		ko.applyBindings(new ViewModel());
		
		
		
		<!-- M2.KO = { -->
			<!-- this.Array: [], -->
			<!-- this.ViewModel: function(object) { -->
				<!-- return 1; -->
			<!-- }, -->
		<!-- }; -->
		
		
		
    </script>
</body>
</html>